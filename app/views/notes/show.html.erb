<% provide(:title, @note.name) %>

<%= render 'notes/random_button' if @omakase %>

<div class="tray-light-withedge">

  <%= render 'users/user_leftcol', { user: @note.user } %>

  <h1>
    <%= @note.name %>
    <%= render 'projects/stagebadge', project: @note if @note.type == 'Project' %>
  </h1>
  <% if current_users_note? @note %>
    <%= link_to '編集する', edit_note_path(@note), class: 'btn btn-info btn-sm'  %>
  <% end %>

  <p class="mb-0"><%= @note.desc %></p>

  <%= render 'comments/comment_form', note: @note if user_can_comment?(@note, current_user) && @note.type == 'RequestBox' %>

</div>

<ul class="nav nav-pills nav-justified mb-3" id="pills_tab" role="tablist">
<li class="nav-item">
  <a class="nav-link active" id="posts_tab" data-toggle="pill" href="#posts" role="tab" aria-controls="posts" aria-selected="true">進捗</a>
</li>
<li class="nav-item">
  <a class="nav-link" id="commentslist_tab" data-toggle="pill" href="#commentslist" role="tab" aria-controls="commentslist" aria-selected="false">コメント</a>
</li>
</ul>
<div class="tab-content" id="pills-tabContent">
<div class="tab-pane fade show active" id="posts" role="tabpanel" aria-labelledby="posts_tab">

  <%= render 'posts/post_form', note: @note if current_users_note?(@note) && @note.type != 'RequestBox' %>
  <%= render 'notes/posts', note: @note %>

</div>
<div class="tab-pane fade" id="commentslist" role="tabpanel" aria-labelledby="commentslist_tab">
  
  <% if user_can_comment?(@note, current_user) && @note.type != 'RequestBox' %>
    <div id="comment-form" class="comment-form control-panel">
      <h3>コメント</h3>
      <%= render 'comments/comment_form', note: @note %>
    </div>
  <% end %>
  <%= render 'notes/comments', {note: @note, comments: @comments} if user_can_see_comments?(@note, current_user) %>

</div>
</div>

<%= render 'notes/shareform', note: @note %>

<%= render 'notes/foot_toolbar', note: @note %>

<% content_for :leftcol do %>
  <% unless @note.watching_users.empty? %>
    <div class="tray-light-withedge">
      <h3><%= @note.watching_users.count %>人のウォッチャー</h3>
      <% @note.watching_users.reverse.take(20).each do |u| %>
        <%= render 'users/user_thumb', user: u %>
      <% end %>
      <%= link_to 'すべて見る', note_watchers_path(@note) %>
    </div>
  <% end %>
<% end %>
